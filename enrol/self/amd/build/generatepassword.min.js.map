{"version":3,"sources":["../src/generatepassword.js"],"names":["define","$","ajax","Template","PasswordUnmask","GeneratePassword","id","ctx","wrapperSelector","wrapper","inputFieldId","attr","passwordUnMask","element","document","querySelectorAll","render","context","then","html","js","before","runTemplateJS","fail","on","proxy","e","type","keyCode","stopImmediatePropagation","preventDefault","currentTarget","getAttribute","generate","resp","warnings","length","inputField","val","key","setDisplayValue","prototype","promise","call","methodname","args","init"],"mappings":"AAyBAA,OAAM,+BAAC,CAAC,QAAD,CAAW,WAAX,CAAwB,gBAAxB,CAA0C,0BAA1C,CAAD,CAAwE,SAASC,CAAT,CAAYC,CAAZ,CAAkBC,CAAlB,CAA4BC,CAA5B,CAA4C,CAStH,GAAIC,CAAAA,CAAgB,CAAG,SAASC,CAAT,CAAaC,CAAb,CAAkB,CACrC,KAAKC,eAAL,CAAuB,mCAAvB,CACA,KAAKC,OAAL,CAAeR,CAAC,CAAC,KAAKO,eAAN,CAAhB,CACA,KAAKE,YAAL,CAAoB,KAAKD,OAAL,CAAaE,IAAb,CAAkB,uBAAlB,CAApB,CACA,KAAKC,cAAL,CAAsB,GAAIR,CAAAA,CAAJ,CAAmB,KAAKM,YAAxB,CAAtB,CACA,GAAIG,CAAAA,CAAO,CAAGC,QAAQ,CAACC,gBAAT,CAA0B,wCAA1B,CAAd,CAEAZ,CAAQ,CAACa,MAAT,CAAgB,qCAAhB,CAAuD,CACnDH,OAAO,CAAE,CAACP,EAAE,CAAEA,CAAL,CAASW,OAAO,CAAEV,CAAlB,CAD0C,CAAvD,EAGCW,IAHD,CAGM,SAASC,CAAT,CAAeC,CAAf,CAAmB,CACrBnB,CAAC,CAACY,CAAD,CAAD,CAAWQ,MAAX,CAAkBF,CAAlB,EACAhB,CAAQ,CAACmB,aAAT,CAAuBF,CAAvB,CAEH,CAPD,EAQCG,IARD,GAUA,KAAKd,OAAL,CAAae,EAAb,CAAgB,gBAAhB,CAAkC,oCAAlC,CAAsEvB,CAAC,CAACwB,KAAF,CAAQ,SAASC,CAAT,CAAY,CACtF,GAAe,UAAX,GAAAA,CAAC,CAACC,IAAF,EAAuC,EAAd,GAAAD,CAAC,CAACE,OAA/B,CAA+C,CAC3C,MACH,CACDF,CAAC,CAACG,wBAAF,GACAH,CAAC,CAACI,cAAF,GALsF,GAMlFxB,CAAAA,CAAE,CAAGoB,CAAC,CAACK,aAAF,CAAgBC,YAAhB,CAA6B,eAA7B,CAN6E,CAOlFzB,CAAG,CAAGmB,CAAC,CAACK,aAAF,CAAgBC,YAAhB,CAA6B,cAA7B,CAP4E,CAQtF,GAAW,WAAP,GAAA1B,CAAE,EAA4B,WAAR,GAAAC,CAA1B,CAA+C,CAC3C,MACH,CACD,GAAIK,CAAAA,CAAc,CAAG,KAAKA,cAA1B,CACA,KAAKqB,QAAL,CAAc3B,CAAd,CAAkBC,CAAlB,EAAuBW,IAAvB,CAA4B,SAASgB,CAAT,CAAe,CACvC,GAA6B,CAAzB,GAAAA,CAAI,CAACC,QAAL,CAAcC,MAAlB,CAAgC,CAC5BxB,CAAc,CAACyB,UAAf,CAA0BC,GAA1B,CAA8BJ,CAAI,CAACK,GAAnC,EACA3B,CAAc,CAAC4B,eAAf,EACH,CACD,QACH,CAND,EAMGjB,IANH,EAOH,CAnBqE,CAmBnE,IAnBmE,CAAtE,CAoBH,CArCD,CA6CAlB,CAAgB,CAACoC,SAAjB,CAA2BR,QAA3B,CAAsC,SAAS3B,CAAT,CAAaC,CAAb,CAAkB,CACpD,GAAImC,CAAAA,CAAO,CACDxC,CAAI,CAACyC,IAAL,CAAU,CAAC,CACjBC,UAAU,CAAE,yBADK,CAEjBC,IAAI,CAAE,CAACvC,EAAE,CAAEA,CAAL,CAASC,GAAG,CAAEA,CAAd,CAFW,CAAD,CAAV,CADV,CAKA,MAAOmC,CAAAA,CAAO,CAAC,CAAD,CACjB,CAPD,CASA,MAAgD,CAW5CI,IAAI,CAAE,cAASxC,CAAT,CAAaW,CAAb,CAAsB,CACxB,MAAO,IAAIZ,CAAAA,CAAJ,CAAqBC,CAArB,CAAyBW,CAAzB,CACV,CAb2C,CAenD,CA9EK,CAAN","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Generate Password functionality.\n *\n * @module     enrol_self/generatepassword\n * @package    enrol_self\n * @class      generatepassword\n * @copyright  2020 Gleimer Mora <gleimermora@catalyst-au.net>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n * @since      3.9\n */\ndefine(['jquery', 'core/ajax', 'core/templates', 'core_form/passwordunmask'], function($, ajax, Template, PasswordUnmask) {\n\n    /**\n     * Constructor for GeneratePassword.\n     *\n     * @param {Number} id\n     * @param {String} ctx\n     * @constructor\n     */\n    var GeneratePassword = function(id, ctx) {\n        this.wrapperSelector = '[data-passwordunmask=\"wrapper\"]';\n        this.wrapper = $(this.wrapperSelector);\n        this.inputFieldId = this.wrapper.attr('data-passwordunmaskid');\n        this.passwordUnMask = new PasswordUnmask(this.inputFieldId);\n        var element = document.querySelectorAll('[data-passwordunmask=\"instructions\"]');\n\n        Template.render('enrol_self/element-generatepassword', {\n            element: {id: id, context: ctx},\n        })\n        .then(function(html, js) {\n            $(element).before(html);\n            Template.runTemplateJS(js);\n            return;\n        })\n        .fail();\n\n        this.wrapper.on('click keypress', '[data-passwordunmask=\"generate\"]', $.proxy(function(e) {\n            if (e.type === 'keypress' && e.keyCode !== 13) {\n                return;\n            }\n            e.stopImmediatePropagation();\n            e.preventDefault();\n            var id = e.currentTarget.getAttribute('data-generate');\n            var ctx = e.currentTarget.getAttribute('data-context');\n            if (id === 'undefined' || ctx === 'undefined') {\n                return;\n            }\n            var passwordUnMask = this.passwordUnMask;\n            this.generate(id, ctx).then(function(resp) {\n                if (resp.warnings.length === 0) {\n                    passwordUnMask.inputField.val(resp.key);\n                    passwordUnMask.setDisplayValue();\n                }\n                return true;\n            }).fail();\n        }, this));\n    };\n\n    /**\n     * Generate the random password.\n     * @param {Number} id\n     * @param {String} ctx\n     * @returns {Promise}\n     */\n    GeneratePassword.prototype.generate = function(id, ctx) {\n        var promise;\n        promise = ajax.call([{\n            methodname: 'enrol_self_generate_key',\n            args: {id: id, ctx: ctx}\n        }]);\n        return promise[0];\n    };\n\n    return /** @alias module:enrol_self/generate */ {\n        // Public variables and functions.\n\n        /**\n         * Initialise the actions helper.\n         *\n         * @method init\n         * @param {Number} id\n         * @param {String} context\n         * @return {GeneratePassword}\n         */\n        init: function(id, context) {\n            return new GeneratePassword(id, context);\n        }\n    };\n});\n"],"file":"generatepassword.min.js"}